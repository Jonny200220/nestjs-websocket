<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebSocket Test Client</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 700px;
        margin: 0 auto;
      }
      #messages {
        border: 1px solid #ccc;
        padding: 10px;
        height: 200px;
        overflow-y: auto;
        margin: 10px 0;
        background: #f9f9f9;
      }
      input,
      button,
      select {
        padding: 10px;
        margin: 5px;
      }
      input {
        width: 60%;
      }
      button {
        cursor: pointer;
      }
      .connected {
        color: green;
        font-weight: bold;
      }
      .disconnected {
        color: red;
      }
      .section {
        border: 1px solid #ddd;
        padding: 15px;
        margin: 15px 0;
        border-radius: 8px;
      }
      .section h3 {
        margin-top: 0;
      }
      .area-tag {
        display: inline-block;
        background: #007bff;
        color: white;
        padding: 3px 8px;
        border-radius: 4px;
        margin: 2px;
        font-size: 12px;
      }
      #currentAreas {
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <h1>üîå Socket.IO Test Client</h1>
    <p>Estado: <span id="status" class="disconnected">Desconectado</span></p>
    <p>√Åreas actuales: <span id="currentAreas">Ninguna</span></p>

    <button onclick="connect()">Conectar</button>
    <button onclick="disconnect()">Desconectar</button>

    <!-- Secci√≥n de √Åreas -->
    <div class="section">
      <h3>üè¢ Gesti√≥n de √Åreas</h3>
      <select id="areaSelect">
        <option value="ventas">Ventas</option>
        <option value="soporte">Soporte</option>
        <option value="desarrollo">Desarrollo</option>
        <option value="rrhh">Recursos Humanos</option>
        <option value="general">General</option>
      </select>
      <button onclick="joinArea()">Unirse al √Årea</button>
      <button onclick="leaveArea()">Salir del √Årea</button>
    </div>

    <!-- Secci√≥n de Mensajes -->
    <div class="section">
      <h3>üí¨ Enviar Mensaje</h3>
      <input
        type="text"
        id="messageInput"
        placeholder="Escribe un mensaje..."
      />
      <br />
      <button onclick="sendMessage()">Enviar a Todos</button>
      <button onclick="sendMessageToArea()">Enviar solo al √Årea</button>
    </div>

    <h3>üì® Mensajes:</h3>
    <div id="messages"></div>

    <script>
      let socket;
      let myAreas = new Set();
      const messagesDiv = document.getElementById('messages');
      const statusSpan = document.getElementById('status');
      const currentAreasSpan = document.getElementById('currentAreas');

      function log(message, type = 'info') {
        const time = new Date().toLocaleTimeString();
        const colors = {
          info: '#333',
          sent: '#007bff',
          received: '#28a745',
          area: '#6f42c1',
          error: '#dc3545',
        };
        messagesDiv.innerHTML += `<p style="color: ${colors[type]}">[${time}] ${message}</p>`;
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }

      function updateAreasDisplay() {
        if (myAreas.size === 0) {
          currentAreasSpan.innerHTML = 'Ninguna';
        } else {
          currentAreasSpan.innerHTML = Array.from(myAreas)
            .map((area) => `<span class="area-tag">${area}</span>`)
            .join(' ');
        }
      }

      function connect() {
        socket = io('http://localhost:3000');

        socket.on('connect', () => {
          statusSpan.textContent = 'Conectado - ID: ' + socket.id;
          statusSpan.className = 'connected';
          log('‚úÖ Conectado al servidor');
        });

        socket.on('disconnect', () => {
          statusSpan.textContent = 'Desconectado';
          statusSpan.className = 'disconnected';
          myAreas.clear();
          updateAreasDisplay();
          log('‚ùå Desconectado del servidor');
        });

        // Escuchar mensajes del servidor
        socket.on('mensajeServer', (data) => {
          log('üì© Mensaje recibido: ' + JSON.stringify(data), 'received');
        });

        // Confirmaci√≥n de unirse a √°rea
        socket.on('joinedArea', (message) => {
          log('üè¢ ' + message, 'area');
        });

        // Confirmaci√≥n de salir del √°rea
        socket.on('leftArea', (message) => {
          log('üö™ ' + message, 'area');
        });
      }

      function disconnect() {
        if (socket) {
          socket.disconnect();
        }
      }

      function joinArea() {
        const area = document.getElementById('areaSelect').value;
        if (socket && area) {
          socket.emit('joinArea', area);
          myAreas.add(area);
          updateAreasDisplay();
          log(`‚û°Ô∏è Solicitando unirse al √°rea: ${area}`, 'area');
        }
      }

      function leaveArea() {
        const area = document.getElementById('areaSelect').value;
        if (socket && area) {
          socket.emit('leaveArea', area);
          myAreas.delete(area);
          updateAreasDisplay();
          log(`‚¨ÖÔ∏è Saliendo del √°rea: ${area}`, 'area');
        }
      }

      function sendMessage() {
        const input = document.getElementById('messageInput');
        const message = input.value;

        if (socket && message) {
          log('üì§ Enviando a todos: ' + message, 'sent');
          socket.emit('message', message);
          input.value = '';
        }
      }

      function sendMessageToArea() {
        const input = document.getElementById('messageInput');
        const message = input.value;
        const area = document.getElementById('areaSelect').value;

        if (socket && message && area) {
          log(`üì§ Enviando al √°rea "${area}": ${message}`, 'sent');
          socket.emit('messageToArea', { area: area, message: message });
          input.value = '';
        }
      }

      // Conectar autom√°ticamente al cargar
      connect();
    </script>
  </body>
</html>

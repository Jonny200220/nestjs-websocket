<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebSocket Test Client</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 600px;
        margin: 0 auto;
      }
      #messages {
        border: 1px solid #ccc;
        padding: 10px;
        height: 200px;
        overflow-y: auto;
        margin: 10px 0;
      }
      input,
      button {
        padding: 10px;
        margin: 5px 0;
      }
      input {
        width: 70%;
      }
      button {
        cursor: pointer;
      }
      .connected {
        color: green;
      }
      .disconnected {
        color: red;
      }
    </style>
  </head>
  <body>
    <h1>Socket.IO Test Client</h1>
    <p>Estado: <span id="status" class="disconnected">Desconectado</span></p>

    <div>
      <input
        type="text"
        id="messageInput"
        placeholder="Escribe un mensaje..."
      />
      <button onclick="sendMessage()">Enviar</button>
    </div>

    <h3>Mensajes:</h3>
    <div id="messages"></div>

    <button onclick="connect()">Conectar</button>
    <button onclick="disconnect()">Desconectar</button>

    <script>
      let socket;
      const messagesDiv = document.getElementById('messages');
      const statusSpan = document.getElementById('status');

      function log(message) {
        const time = new Date().toLocaleTimeString();
        messagesDiv.innerHTML += `<p>[${time}] ${message}</p>`;
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }

      function connect() {
        socket = io('http://localhost:3000');

        socket.on('connect', () => {
          statusSpan.textContent = 'Conectado - ID: ' + socket.id;
          statusSpan.className = 'connected';
          log('âœ… Conectado al servidor');
        });

        socket.on('disconnect', () => {
          statusSpan.textContent = 'Desconectado';
          statusSpan.className = 'disconnected';
          log('âŒ Desconectado del servidor');
        });

        socket.on('message', (data) => {
          log('ðŸ“© Respuesta del servidor: ' + JSON.stringify(data));
        });
      }

      function disconnect() {
        if (socket) {
          socket.disconnect();
        }
      }

      function sendMessage() {
        const input = document.getElementById('messageInput');
        const message = input.value;

        if (socket && message) {
          log('ðŸ“¤ Enviando: ' + message);
          socket.emit('message', message, (response) => {
            log('âœ… Acknowledgment: ' + JSON.stringify(response));
          });
          input.value = '';
        }
      }

      // Conectar automÃ¡ticamente al cargar
      connect();
    </script>
  </body>
</html>
